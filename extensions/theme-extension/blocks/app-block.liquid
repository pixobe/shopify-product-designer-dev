<script>
  (function () {
    const script = document.createElement('script');
    script.type = 'module';
    script.async = true;
    script.src = 'https://localapp.pixobe.com/build/product-designer.esm.js';
    document.head.appendChild(script);
  })();
</script>

{%- assign variants = product.variants -%}
{%- for v in variants -%}
  {%- assign media_items = v.metafields['$app'].pixobe_media_items.value -%}
  {%- assign has_media = false -%}
  {%- if media_items != blank and media_items.size > 0 -%}
    {%- assign has_media = true -%}
    {%- break -%}
  {%- endif -%}
{%- endfor -%}

{% assign app_admin_url = 'https://admin.shopify.com/store/'
  | append: shop.permanent_domain
  | remove: '.myshopify.com'
  | append: '/apps/pixobe-product-designer/app/configure-product-media?id=gid%3A%2F%2Fshopify%2FProduct%2F'
  | append: product.id
%}

<div class="pixobe-product-design-block" {{ block.shopify_attributes }}>
  {% if has_media %}
    {% render 'customize-button',
      button_border_radius: block.settings.button_border_radius,
      button_full_width: block.settings.button_full_width,
      button_background_color: block.settings.button_background_color,
      button_text_color: block.settings.button_text_color,
      button_hover_color: block.settings.button_hover_color,
      button_text_hover_color: block.settings.button_text_hover_color,
      button_border_width: block.settings.button_border_width,
      button_border_color: block.settings.button_border_color
    %}
  {% else %}
    {% if request.design_mode %}
      <div class="pixobe-empty-state" role="status">
        <p class="pixobe-empty-state__title">{{ 'pixobe.empty_state.title' | t }}</p>
        <p class="pixobe-empty-state__body">{{ 'pixobe.empty_state.body' | t }}</p>
        <div class="pixobe-empty-state__actions">
          <a
            href="{{ app_admin_url }}"
            class="pixobe-empty-state__link"
            target="_blank"
            rel="noreferrer"
          >
            {{ 'pixobe.empty_state.enable_customization' | t }}
          </a>
        </div>
      </div>
    {% endif %}
  {% endif %}
</div>

{% schema %}
{
  "name": "Product Customize Button",
  "target": "section",
  "settings": [
    { "type": "color", "id": "button_background_color", "label": "Button colour", "default": "#000000" },
    { "type": "color", "id": "button_text_color", "label": "Button text colour", "default": "#ffffff" },
    { "type": "color", "id": "button_hover_color", "label": "Button hover colour", "default": "#000000" },
    { "type": "color", "id": "button_text_hover_color", "label": "Button text hover colour", "default": "#ffffff" },
    { "type": "number", "id": "button_border_radius", "label": "Button border radius", "default": 14 },
    { "type": "number", "id": "button_margin", "label": "Margin Top", "default": 16 },
    {
      "type": "range",
      "id": "button_border_width",
      "label": "Button border width",
      "min": 0,
      "max": 10,
      "step": 1,
      "unit": "px",
      "default": 1
    },
    { "type": "color", "id": "button_border_color", "label": "Button border colour", "default": "#000000" },
    { "type": "checkbox", "id": "button_full_width", "label": "Full width button", "default": false }
  ]
}
{% endschema %}
